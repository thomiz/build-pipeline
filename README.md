# FHIR build

Document how to build a CI/CD pipeline for your FHIR Implementationu Guide using FSH, SUSHI, docker some scripts and tasks.

## Prerequisites

To run the Docker images, install Docker, a personal license should suffice.
[Docker](https://www.docker.com/get-started)

### Build Docker image

Build a docker image using the vscode task or command-line:

~~~bash
docker build -t navikt/fhir-ig-dev .
~~~

The docker image settings is contained in the "Dockerfile" configuration file of the repo.

### Setup your GitHub repo

You will need a gh-pages branch to contain the files produced from you IG build process.  
Goto the Settings->Pages, choose none and press "choose a theme", commit the autogenerated README.md (or edit it first).

>If you add github pages to your repo you have to: 
Choose a theme AND commit the README.md file that is autogenerated by github if Github is to make a separate **gh-pages** branch in your repo.  After this you only have to make the result of the build process available in the gh-pages branch to make this work.

Clone the gh-pages branch to a separate directory locally where you store all the files from the IG-generation "output" catalog. This will be where you place the files from the IG generation process that you want to publish.

### Make an ImplementationGuide

In a separate folder under "igs", define your IG and the FHIR artifacts (profiles, extensions etc.). Artifacts goes in the input folder.  FHIR artifacts can be converted from xml/json to FSH or written by hand using the FSH language. IG-publisher can take FHIR XML/JSON Definition but then you have to write your own ImplementationGuide resource.  
You need three files to get started with IG build process:
* ig.ini - Defines the template for the IG and where the generated ImplementationGuide resouces is to be found.
* sushi-config.yaml - Defines configuration for your implementation guide to the SUSHI IG generation part of the IG-Publisher
* input/pages/index.md - The starting page of your implementation guide, usually written i markdown

The actual FHIR definitions goes into the fsh folder, full writeup of the catalog structure for [IG-generation](https://fshschool.org/docs/sushi/project/#ig-projects):
* input/fsh/* - All the fsh files defining your FHIR artifacts (profiles, search parameters, codesystems etc.)

## Projects and documentation

* [NAV's writeup of the buildprocess](https://github.com/navikt/fhir)
* [The official HL7 auto IG builder](https://github.com/FHIR/auto-ig-builder)
* [Dockerized build image for IG publisher](https://github.com/NIH-NCPI/hl7-fhir-ig-publisher)
* [IG release pipeline walkthroug (HL7 Belgium)](https://github.com/hl7-be/fhir-ig-release-publication)
* [An important script for the GitHub workflow](https://github.com/hl7-be/tutorial_ig/tree/master/.github/workflows)
* [Docker build alternative](https://github.com/logicahealth/fhir-ig-base)
  * [The actual Docker image for download](https://hub.docker.com/r/logicahealth/fhir-ig-base)
* [FSH/SUSHI School](https://fshschool.org/docs/)
* [Guidance for FHIR IG Creation](http://build.fhir.org/ig/FHIR/ig-guidance/index.html)
